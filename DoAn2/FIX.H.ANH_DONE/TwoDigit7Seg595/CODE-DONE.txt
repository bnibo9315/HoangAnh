#include <ShiftRegister74HC595.h>

ShiftRegister74HC595 sr (2, 2, 3, 4);
ShiftRegister74HC595 sr1 (2, 5, 6, 7);  

#define R 8
#define Y 9
#define G 10

#define R1 11
#define Y1 12
#define G1 13

#define U1 A0
#define U2 A1

int number=5; 
int number_Y=2;
int number_G=8;;

//int number1=5; 
//int number_Y1=2;
//int number_G1=8;

//unsigned long time1 =0;
//unsigned long time2 =0;


int value,digit1,digit2,digit3,digit4; 
uint8_t  numberB[] = {B11000000, //0
                      B11111001, //1 
                      B10100100, //2
                      B10110000, //3 
                      B10011001, //4
                      B10010010, //5
                      B10000011, //6
                      B11111000, //7
                      B10000000, //8
                      B10011000 //9
                     };

uint8_t  numberB1[] = {B11000000, //0
                      B11111001, //1 
                      B10100100, //2
                      B10110000, //3 
                      B10011001, //4
                      B10010010, //5
                      B10000011, //6
                      B11111000, //7
                      B10000000, //8
                      B10011000 //9
                     };

void countDown_R();
void countDown_Y();
void countDown_G();

void countDown_R1();
void countDown_Y1();
void countDown_G1();

void trai();
void phai();
void tong();

void setup() {
  pinMode(R,OUTPUT);  digitalWrite(R,0);
  pinMode(Y,OUTPUT);  digitalWrite(Y,0);
  pinMode(G,OUTPUT);  digitalWrite(G,0);

  pinMode(R1,OUTPUT); digitalWrite(R1,0);
  pinMode(Y1,OUTPUT); digitalWrite(Y1,0);
  pinMode(G1,OUTPUT); digitalWrite(G1,0);

  pinMode(U1,INPUT); 
  pinMode(U2,INPUT); 


  //Count from 0 to 'number' 
  //countUp();
  //countUp1();
  //Count from 'number' to 0
  //countDown();  // <--- Comment countUp and uncomment countDown
  //countDown_Y();
  //countDown1();
  //Blink 4 times all on and all off.
  //blink();  
}

void loop() 
{
  Serial.begin(9600);
  Serial.println("U1:");
  Serial.println(digitalRead(U1));
  Serial.println("U2:");
  Serial.println(digitalRead(U2));
 // delay(500);

 
  number=5;//xanh va do = 5s
  for (number; number>=0; number--){
    //Split number to digits:
    digit2=number % 10 ;
    digit4=number % 10 ;
    digit1=(number / 10) % 10 ;
    digit3=(number / 10) % 10 ;
    //Send them to 7 segment displays
    
    digitalWrite(R,1);
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};   
    sr.setAll(numberToPrint); 
    
    digitalWrite(G1,1);
    uint8_t numberToPrint1[]= {numberB[digit4],numberB[digit3]};
    sr1.setAll(numberToPrint);   
/////////////////////////////////////////////////////////////////////
    if(digitalRead(U2)==0) 
    {
      digitalWrite(G1,0);
      sr.setAllHigh();
      for(int i=10; i>0; i--)      
      {
         digitalWrite(R1,1);delay(100);      
         digitalWrite(R1,0);delay(100);      
         digitalWrite(R1,1);delay(100);
         digitalWrite(R1,0);delay(100);
      }
    }
/////////////////////////////////////////////////////////////////////
    
    //Reset them for next time
    digit1=0;
    digit2=0;
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
  
  digitalWrite(R,0);
  digitalWrite(G1,0);
  //////////////////////////////////////////////////////////////
  
  number_Y=3;//do va vang
  for (number_Y; number_Y>=0; number_Y--){
    //Split number to digits:
    digit2=number_Y % 10 ;
    digit4=number_Y % 10 ;
    digit1=(number_Y / 10) % 10 ;
    digit3=(number_Y / 10) % 10 ;
    //Send them to 7 segment displays
    
    digitalWrite(Y,1);
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};   
    sr.setAll(numberToPrint); 
    
    digitalWrite(R1,1);
    uint8_t numberToPrint1[]= {numberB[digit4],numberB[digit3]};
    sr1.setAll(numberToPrint);   
    //Reset them for next time
    digit1=0;
    digit2=0;
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
  digitalWrite(Y,0);
  digitalWrite(R1,0);
  //////////////////////////////////////////////////////////////
  
  number_G=8;// Xanh va vang
  for (number_G; number_G>=0; number_G--){
    //Split number to digits:
    digit2=number_G % 10 ;
    digit4=number_G % 10 ;
    digit1=(number_G / 10) % 10 ;
    digit3=(number_G / 10) % 10 ;
    //Send them to 7 segment displays
    
    digitalWrite(G,1);
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};   
    sr.setAll(numberToPrint); 

    if(digitalRead(U1)==0) 
    {
      digitalWrite(G,0);
      sr.setAllHigh();//delay(100);sr.setAllLow();delay(100);sr.setAllHigh();delay(100);sr.setAllLow();delay(100);
      for(int i=10; i>0; i--)      
      {
         digitalWrite(R,1);delay(100);      
         digitalWrite(R,0);delay(100);      
         digitalWrite(R,1);delay(100);
         digitalWrite(R,0);delay(100);
      }
    }
    
    digitalWrite(R1,1);
    uint8_t numberToPrint1[]= {numberB[digit4],numberB[digit3]};
    sr1.setAll(numberToPrint);   
    //Reset them for next time
    digit1=0;
    digit2=0;
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
  digitalWrite(G,0);
  digitalWrite(R1,0);

  /////////////////////////////////////////////////////////////////
  number_Y=3;// Xanh ve do
  
  for (number_Y; number_Y>=0; number_Y--){
    //Split number to digits:
    digit2=number_Y % 10 ;
    digit4=number_Y % 10 ;
    digit1=(number_Y / 10) % 10 ;
    digit3=(number_Y / 10) % 10 ;
    //Send them to 7 segment displays
    
    digitalWrite(R,1);
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};   
    sr.setAll(numberToPrint); 
    
    
    digitalWrite(Y1,1);
    uint8_t numberToPrint1[]= {numberB[digit4],numberB[digit3]};
    sr1.setAll(numberToPrint);   
    //Reset them for next time
    digit1=0;
    digit2=0;
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
  digitalWrite(R,1);
  digitalWrite(Y1,0);
  /////////////////////////////////////////////////////////////////
}
/*
///////////////////////////////////////////////////////////////
void countDown_R(){
  number=5;
  for (number; number>=0; number--){
    //Split number to digits:
    digit2=number % 10 ;
    digit1=(number / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};
    sr.setAll(numberToPrint); 
    //Reset them for next time
    digit1=0;
    digit2=0;
    delay(1000); // Repeat every 1 sec
  }
}
////////////////////////////////////////////////////////////////
void countDown_Y(){
  number_Y = 3;
  for (number_Y; number_Y>=0; number_Y --){
    //Split number to digits:
    digit2=number_Y % 10 ;
    digit1=(number_Y / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};
    sr.setAll(numberToPrint); 
    //Reset them for next time
    digit1=0;
    digit2=0;
    delay(1000); // Repeat every 1 sec
  }
}
////////////////////////////////////////////////////////////
/*
void trai()
{
  digitalWrite(R,1);    
  countDown_R();        
  digitalWrite(R,0); 
  delay(500);       
     
  digitalWrite(Y,1);   
  countDown_Y();
  digitalWrite(Y,0); 
  delay(500);
  
  digitalWrite(G,1); 
  countDown_G();
  digitalWrite(G,0);
  delay(1000);
}
////////////////////////////////////////////////////////////
void tong()
{
  digitalWrite(R,1);    
  countDown_R();        
  digitalWrite(R,0); 
  delay(500);       
     
  digitalWrite(Y,1);   
  countDown_Y();
  digitalWrite(Y,0); 
  delay(500);
  
  digitalWrite(G,1); 
  countDown_G();
  digitalWrite(G,0);
  delay(1000);
}
////////////////////////////////////////////////////////////
void phai()
{
  digitalWrite(G1,1);  //G  
  countDown_G1();        
  digitalWrite(G1,0);    
  delay(500);       
     
  digitalWrite(Y1,1);    
  countDown_Y1();
  digitalWrite(Y1,0);
  delay(500);
  
  digitalWrite(R1,1);  //R
  countDown_R1();
  digitalWrite(R1,0);
  delay(1000);
}
////////////////////////////////////////////////////////////
void countDown_R(){
  number=5;
  for (number; number>=0; number--){
    //Split number to digits:
    digit2=number % 10 ;
    digit1=(number / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};
    sr.setAll(numberToPrint); 
    //Reset them for next time
    digit1=0;
    digit2=0;
    delay(1000); // Repeat every 1 sec
  }
}
///////////////////////////////////////////////////////////
void countDown_R1(){
  number1 = 5;
  for (number1; number1>=0; number1--){
    //Split number to digits:
    digit4=number1 % 10 ;                                       
    digit3=(number1 / 10) % 10 ;                               
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB1[digit4],numberB1[digit3]}; //uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};
    sr1.setAll(numberToPrint); 
    //Reset them for next time
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
}
///////////////////////////////////////////////////////////
void countDown_Y(){
  number_Y = 3;
  for (number_Y; number_Y>=0; number_Y --){
    //Split number to digits:
    digit2=number_Y % 10 ;
    digit1=(number_Y / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};
    sr.setAll(numberToPrint); 
    //Reset them for next time
    digit1=0;
    digit2=0;
    delay(1000); // Repeat every 1 sec
  }
}
//////////////////////////////////////////////////////////////////
void countDown_Y1(){
  number_Y1 = 3;
  for (number_Y1; number_Y1>=0; number_Y1 --){
    //Split number to digits:
    digit4=number_Y1 % 10 ;
    digit3=(number_Y1 / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB1[digit4],numberB1[digit3]};
    sr1.setAll(numberToPrint); 
    //Reset them for next time
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
}
/////////////////////////////////////////////////////////////////
void countDown_G(){
  number_G = 8;
  for (number_G; number_G>=0; number_G --){
    //Split number to digits:
    digit2=number_G % 10 ;
    digit1=(number_G / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB[digit2],numberB[digit1]};
    sr.setAll(numberToPrint); 
    //Reset them for next time
    digit1=0;
    digit2=0;
    delay(1000); // Repeat every 1 sec
  }
}
////////////////////////////////////////////////////////////
void countDown_G1(){
  number_G1 = 8;
  for (number_G1; number_G1>=0; number_G1 --){
    //Split number to digits:
    digit4=number_G1 % 10 ;
    digit3=(number_G1 / 10) % 10 ;
    //Send them to 7 segment displays
    uint8_t numberToPrint[]= {numberB1[digit4],numberB1[digit3]};
    sr1.setAll(numberToPrint); 
    //Reset them for next time
    digit3=0;
    digit4=0;
    delay(1000); // Repeat every 1 sec
  }
}
////////////////////////////////////////////////////////////
*/
//Blink
void blink(){
  for(int i = 0; i<3; i++){
    sr.setAllLow(); // set all pins Low (off)
    delay(1000);
    sr.setAllHigh(); // set all pins High (on)
    delay(1000);
  }
}